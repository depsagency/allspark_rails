<% content_for :title, "Edit #{@mcp_server.name}" %>

<div class="container mx-auto px-4 py-6 max-w-4xl">
  <!-- Header Section -->
  <div class="mb-6">
    <div class="breadcrumbs text-sm mb-2">
      <ul>
        <li><%= link_to "Admin", "#", class: "text-primary" %></li>
        <li><%= link_to "MCP Servers", admin_mcp_servers_path, class: "text-primary" %></li>
        <li><%= link_to @mcp_server.name, admin_mcp_server_path(@mcp_server), class: "text-primary" %></li>
        <li>Edit</li>
      </ul>
    </div>
    <h1 class="text-3xl font-bold text-gray-900 mb-2">Edit MCP Server</h1>
    <p class="text-gray-600">Update configuration for <%= @mcp_server.name %>.</p>
  </div>

  <!-- Current Status Alert -->
  <div class="alert <%= @mcp_server.active? ? 'alert-success' : 'alert-warning' %> mb-6">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
      <% if @mcp_server.active? %>
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      <% else %>
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
      <% end %>
    </svg>
    <div>
      <h3 class="font-bold">Server Status: <%= @mcp_server.status.humanize %></h3>
      <div class="text-sm">
        <% if @mcp_server.active? %>
          This server is currently active and available to all users.
        <% elsif @mcp_server.inactive? %>
          This server is currently inactive and not available for use.
        <% else %>
          This server is in an error state. Check the connection and configuration.
        <% end %>
        
        <% tool_count = @mcp_server.available_tools.size rescue 0 %>
        <% if tool_count > 0 %>
          <br><strong><%= tool_count %></strong> tools are currently available from this server.
        <% end %>
      </div>
    </div>
  </div>

  <!-- Warning about changes -->
  <div class="alert alert-warning mb-6">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
    </svg>
    <div>
      <h3 class="font-bold">Important</h3>
      <div class="text-sm">
        Changes to the endpoint URL or authentication configuration will trigger a connection test and tool rediscovery.
        Active connections to this server may be temporarily interrupted.
      </div>
    </div>
  </div>

  <!-- Form -->
  <%= render 'form' %>
  
  <!-- Danger Zone -->
  <div class="card bg-base-100 shadow-xl border-error mt-6">
    <div class="card-body">
      <h2 class="card-title text-error mb-4">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
        </svg>
        Danger Zone
      </h2>
      
      <p class="text-gray-600 mb-4">
        Once you delete this MCP server, there is no going back. This will remove the server configuration,
        disconnect all active connections, and remove access to its tools for all users.
      </p>
      
      <%= link_to admin_mcp_server_path(@mcp_server), 
          method: :delete,
          data: { 
            confirm: "Are you sure you want to delete '#{@mcp_server.name}'? This action cannot be undone.\n\nType the server name to confirm: #{@mcp_server.name}"
          },
          class: "btn btn-error" do %>
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
        </svg>
        Delete Server
      <% end %>
    </div>
  </div>
</div>