<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-8">
    <h1 class="text-3xl font-bold">Create New Team</h1>
    <%= link_to "Back to Teams", agents_teams_path, class: "btn btn-ghost" %>
  </div>

  <div class="max-w-2xl">
    <%= form_with model: @team, url: agents_teams_path, class: "space-y-6" do |form| %>
      <% if @team.errors.any? %>
        <div class="alert alert-error">
          <h3 class="font-bold">Please fix the following errors:</h3>
          <ul class="list-disc list-inside">
            <% @team.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div class="form-control">
        <%= form.label :name, class: "label" %>
        <%= form.text_field :name, class: "input input-bordered", required: true, 
            placeholder: "e.g., Customer Support Team" %>
      </div>

      <div class="form-control">
        <%= form.label :purpose, class: "label" %>
        <%= form.text_area :purpose, rows: 4, class: "textarea textarea-bordered", 
            placeholder: "Describe the team's purpose and goals..." %>
      </div>

      <div class="form-control">
        <%= form.label :workflow, class: "label" %>
        <%= form.text_area :workflow, rows: 6, class: "textarea textarea-bordered font-mono text-sm", 
            placeholder: "Define the team's workflow in YAML format..." %>
        <label class="label">
          <span class="label-text-alt">Use YAML format to define team workflow and coordination</span>
        </label>
      </div>

      <div class="form-control">
        <%= form.label :active, class: "label cursor-pointer" do %>
          <span class="label-text">Active</span>
          <%= form.check_box :active, class: "toggle toggle-primary", checked: true %>
        <% end %>
      </div>

      <div class="divider">Team Members</div>

      <% if current_user.assistants.any? %>
        <div class="form-control">
          <label class="label">
            <span class="label-text">Select Assistants</span>
            <span class="label-text-alt">Choose which assistants are part of this team</span>
          </label>
          <div class="space-y-2 max-h-60 overflow-y-auto p-4 bg-base-200 rounded-lg">
            <%= hidden_field_tag "agent_team[assistant_ids][]", "" %>
            <% current_user.assistants.active.each do |assistant| %>
              <label class="flex items-center space-x-3 cursor-pointer hover:bg-base-300 p-2 rounded">
                <%= check_box_tag "agent_team[assistant_ids][]", assistant.id, false, 
                    class: "checkbox checkbox-primary", 
                    id: "assistant_#{assistant.id}" %>
                <div class="flex-1">
                  <div class="font-medium"><%= assistant.name %></div>
                  <% if assistant.instructions.present? %>
                    <div class="text-sm opacity-70"><%= truncate(assistant.instructions, length: 60) %></div>
                  <% end %>
                </div>
                <% if assistant.tools.any? %>
                  <div class="flex gap-1">
                    <% assistant.tools.each do |tool| %>
                      <div class="badge badge-xs"><%= tool['type'] %></div>
                    <% end %>
                  </div>
                <% end %>
              </label>
            <% end %>
          </div>
        </div>
      <% else %>
        <div class="alert alert-info">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <div>
            <p>You need to create AI assistants before you can add them to a team.</p>
            <%= link_to "Create Assistant", new_agents_assistant_path, class: "link link-primary" %>
          </div>
        </div>
      <% end %>

      <div class="form-actions flex gap-2">
        <%= form.submit "Create Team", class: "btn btn-primary" %>
        <%= link_to "Cancel", agents_teams_path, class: "btn btn-ghost" %>
      </div>
    <% end %>
  </div>
</div>