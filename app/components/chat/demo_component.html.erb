<div class="chat-demo h-[600px] flex bg-base-100 rounded-lg shadow-lg overflow-hidden border">
  <!-- Thread List Sidebar -->
  <div class="w-80 border-r flex-shrink-0 bg-base-200 flex flex-col">
    <div class="p-4 border-b flex-shrink-0">
      <h3 class="text-lg font-semibold">Messages</h3>
    </div>
    
    <div class="flex-1 overflow-y-auto">
      <% demo_threads.each do |thread| %>
        <div class="chat-thread-item p-4 hover:bg-base-300 cursor-pointer border-b <%= 'bg-base-300' if thread[:active] %>">
          <div class="flex items-start justify-between">
            <div class="flex-1 min-w-0">
              <h4 class="font-semibold text-sm truncate"><%= thread[:name] %></h4>
              <p class="text-sm text-base-content/70 truncate mt-1"><%= thread[:last_message] %></p>
            </div>
            <div class="flex flex-col items-end ml-2">
              <span class="text-xs text-base-content/50"><%= thread[:time] %></span>
              <% if thread[:unread] > 0 %>
                <span class="badge badge-primary badge-sm mt-1"><%= thread[:unread] %></span>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
  
  <!-- Main Chat Area -->
  <div class="flex-1 flex flex-col">
    <!-- Chat Header -->
    <div class="p-4 border-b bg-base-100">
      <h3 class="text-lg font-semibold">General Discussion</h3>
      <p class="text-sm text-base-content/70">5 participants</p>
    </div>
    
    <!-- Messages Container -->
    <div class="flex-1 overflow-y-auto p-4 space-y-4 relative chat-messages-container" style="max-height: 400px;">
      <% if demo_messages.empty? %>
        <div class="h-full flex items-center justify-center text-base-content/50">
          <div class="text-center">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-16 h-16 mx-auto mb-4 opacity-50">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z" />
            </svg>
            <p class="text-lg">No messages yet</p>
            <p class="text-sm mt-2">Start the conversation!</p>
          </div>
        </div>
      <% else %>
        <% demo_messages.each do |message| %>
          <div class="chat <%= message[:is_own] ? 'chat-end' : 'chat-start' %>">
            <div class="chat-image avatar">
              <div class="w-10 rounded-full bg-primary text-primary-content">
                <div class="flex items-center justify-center h-full font-semibold">
                  <%= message[:user].split.map(&:first).join %>
                </div>
              </div>
            </div>
            <div class="chat-header">
              <%= message[:user] %>
              <time class="text-xs opacity-50"><%= message[:time] %></time>
              <% if message[:edited] %>
                <span class="text-xs opacity-50">(edited)</span>
              <% end %>
            </div>
            <div class="chat-bubble <%= message[:is_own] ? 'chat-bubble-primary' : '' %>">
              <%= message[:content] %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
    
    <!-- Typing Indicator (optional demo) -->
    <% if @variant == :typing %>
      <div class="px-4 py-2 text-sm text-base-content/50">
        <span class="loading loading-dots loading-sm"></span> Alice is typing...
      </div>
    <% end %>
    
    <!-- Message Input -->
    <div class="border-t p-4">
      <form class="flex gap-2">
        <input type="text" 
               placeholder="Type a message..." 
               class="input input-bordered flex-1"
               <%= 'disabled' if demo_messages.empty? && @variant != :empty %>>
        <button type="submit" class="btn btn-primary" <%= 'disabled' if demo_messages.empty? && @variant != :empty %>>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
          </svg>
        </button>
      </form>
    </div>
  </div>
</div>

<style>
  .chat-demo {
    font-family: inherit;
  }
  
  .chat-thread-item {
    transition: background-color 0.2s;
  }
  
  .chat-bubble {
    max-width: 70%;
    word-wrap: break-word;
  }
  
  /* Ensure messages container has proper scrolling */
  .chat-messages-container {
    min-height: 0; /* Important for Firefox */
    max-height: 400px;
  }
</style>

<% if @variant == :long_conversation %>
<script>
  // Auto-scroll to bottom for long conversation demo
  document.addEventListener('DOMContentLoaded', function() {
    const messagesContainer = document.querySelector('.chat-messages-container');
    if (messagesContainer) {
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
  });
</script>
<% end %>